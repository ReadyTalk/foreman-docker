apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ template "foreman.fullname" . }}-init
  labels:
    app: {{ template "foreman.name" . }}
    chart: {{ template "foreman.chart" . }}
    release: {{ .Release.Name }}
    heritage: {{ .Release.Service }}
    component: server
data:
  init.sh: |-
    #!/bin/bash
    bundle exec rake db:migrate RAIL_ENV={{ .Values.foreman.railsenv }}
    bundle exec rake db:seed RAILS_ENV={{ .Values.foreman.railsenv }}
    bundle exec rake assets:precompile RAILS_ENV={{ .Values.foreman.railsenv }}
    bundle exec rake locale:pack RAILS_ENV={{ .Values.foreman.railsenv }}
    bundle exec rake webpack:compile RAILS_ENV={{ .Values.foreman.railsenv }}

    bundle exec rake permissions:reset RAILS_ENV={{ .Values.foreman.railsenv }}
    chown -R 9999:9999 /home/app/foreman/tmp

