apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ template "foreman.fullname" . }}-init
  labels:
    app: {{ template "foreman.name" . }}
    chart: {{ template "foreman.chart" . }}
    release: {{ .Release.Name }}
    heritage: {{ .Release.Service }}
    component: server
data:
  init.sh: |-
    #!/bin/bash
    cd /home/app/foreman
    bundle exec rake db:migrate
    bundle exec rake db:seed
    bundle exec rake assets:precompile
    bundle exec rake locale:pack
    bundle exec rake webpack:compile 

    bundle exec rake permissions:reset RAILS_ENV={{ .Values.foreman.railsenv }} 
    chown -R 9999:9999 /home/app/foreman

